# CLAUDE.md

このファイルは、このリポジトリでコードを操作する際にClaude Code (claude.ai/code) にガイダンスを提供します。

プロジェクトの概要はREADME.mdを参照してください。

## 設計方針

ソフトウェアが満たすべき要件・仕様・制約を以下の３種類に分類します。

- モデル ・・・ 知識を概念同士の関係性として形式的に記述します。TypeScriptによって記述し、`/docs/model.ts`に格納します。DBスキーマのような物理モデルは、このモデルのサブセットとなるようにします。また、アプリケーションの実装に必要な概念が欠けている場合は、`model.ts`の改善を提案してください。
- システム ・・・ DBや認証方式、ライブラリ、デプロイ方法など、モデルとアプリケーションの内容をソフトウェア的に実現する上で指定したい情報を記述します。当ファイルに記述します。
- アプリケーション ・・・ 機能群やバリデーションなどを指します。逐一プロンプトとして指示するので、内容を要約して`/docs/SPEC.md`に記載してください。モデルとシステムの内容をベースに、プロンプトをアプリケーションとして実装するのがClaudeの役割です。

### システム

#### ボイラープレート

`/docs/SPEC.md`が存在しない場合、ボイラープレートの状態である。

使用しているボイラープレートは以下のURLのもの。

https://vercel.com/templates/next.js/nextjs-boilerplate

#### 開発コマンド

- `npm run dev` - Turbopackを使用して開発サーバーを起動
- `npm run build` - 本番用にアプリケーションをビルド
- `npm run start` - 本番サーバーを起動
- `npm run lint` - ESLintを実行してコード品質をチェック
- `npm run db:migrate` - データベースマイグレーションを実行
- `npm run db:generate` - Prismaクライアントを生成
- `npm run db:push` - スキーマ変更をデータベースにプッシュ
- `npm run db:studio` - データベース管理用のPrisma Studioを開く

#### セットアップ手順

1. Dockerサービスを開始: `docker-compose up -d`
2. 依存関係をインストール: `npm install`
3. データベーススキーマをプッシュ: `npm run db:push`
4. Prismaクライアントを生成: `npm run db:generate`
5. 開発サーバーを起動: `npm run dev`

開発中に送信されたメールを確認するには、http://localhost:8025 でMailHog Webインターフェースにアクセスしてください。

#### フレームワーク

- Next.js 15
  - App Router
  - `app`配下はサーバーコンポーネントを置き、機能固有のクライアントコンポーネントは`components/features`配下に置いてimportする
  - 通信はなるべくサーバーアクションで行い、サーバーコンポーネントからクライアントコンポーネントにインジェクトする

#### スタイリング

- Tailwind CSS v4 with PostCSS
- フォントはGeist SansとGeist MonoがCSS変数として設定済み

#### 言語

- TypeScript
  - パスエイリアス（`@/*`はプロジェクトルートにマップ）を使用したStrictモードが有効

#### DB

- mysql
- prisma
- ローカルではdockerイメージを利用して、docker-compose.ymlに追加

#### SMTP

- ローカルではmailhogのdockerイメージを使用して、docker-compose.ymlに追加

#### 認証

- マジックリンクをメールで送信すること
- サインアップあるいはログインに成功すると、ログインデータが作成され、十分なエントロピーを確保したトークンがログインデータとクッキー内に設定される。
- 各リクエストにおいて、クッキー内のトークンを元にDB検索を行い、期限切れをしていないログインデータが存在すれば、認証成功とする。
- ユーザー情報が必要な場合は、ログインデータ内のアカウントIDを元に引いてくることができる。
- ログアウト時は、ログインデータを削除する。
- トークンは発行時にURLパラメータにのみ設定してよく、データベースから取得してはならない。クッキーから取得したトークンを絞り込み条件に設定して比較するのはOK。

#### プロセス管理

- 開発サーバーなどの自動立ち上げの際（`npm run dev`等）は、すべて`procm-mcp`を使って立ち上げること
- エラーログの確認も`procm-mcp`を使って確認し、対処すること
